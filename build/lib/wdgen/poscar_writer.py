class PoscarWriter:
    @staticmethod
    def save(filename, atoms, box_size):
        atoms_sorted = sorted(atoms, key=lambda x: x[0])
        species = sorted(set(atom[0] for atom in atoms_sorted))
        species_counts = {s: sum(1 for atom in atoms_sorted if atom[0] == s) for s in species}

        with open(filename, 'w') as f:
            f.write("Generated by Python Script\n")
            f.write("1.0\n")
            for dim in box_size:
                f.write(f"{dim[0]:.5f} {dim[1]:.5f} {dim[2]:.5f}\n")
            f.write(" ".join(species) + "\n")
            f.write(" ".join(str(species_counts[s]) for s in species) + "\n")
            f.write("Cartesian\n")
            for atom in atoms_sorted:
                f.write(f"{atom[1]:.5f} {atom[2]:.5f} {atom[3]:.5f}\n")
